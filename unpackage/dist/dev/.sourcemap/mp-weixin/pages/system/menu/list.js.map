{"version":3,"sources":["uni-app:///main.js","webpack:///E:/Uni/helloword/pages/system/menu/list.vue?e513","webpack:///E:/Uni/helloword/pages/system/menu/list.vue?9700","webpack:///E:/Uni/helloword/pages/system/menu/list.vue?c495","webpack:///E:/Uni/helloword/pages/system/menu/list.vue?c7a3","uni-app:///pages/system/menu/list.vue","webpack:///E:/Uni/helloword/pages/system/menu/list.vue?4bda","webpack:///E:/Uni/helloword/pages/system/menu/list.vue?5e40"],"names":["createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,gG;AACAA,UAAU,CAACC,aAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAiH;AACjH;AACwD;AACL;AACa;;;AAGhE;AAC4K;AAC5K,gBAAgB,+KAAU;AAC1B,EAAE,0EAAM;AACR,EAAE,+EAAM;AACR,EAAE,wFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,mFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,gQAEN;AACP,KAAK;AACL;AACA,aAAa,+TAEN;AACP,KAAK;AACL;AACA,aAAa,gQAEN;AACP,KAAK;AACL;AACA,aAAa,8OAEN;AACP,KAAK;AACL;AACA,aAAa,8OAEN;AACP,KAAK;AACL;AACA,aAAa,8OAEN;AACP,KAAK;AACL;AACA,aAAa,oMAEN;AACP;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AC/DA;AAAA;AAAA;AAAA;AAAioB,CAAgB,wnBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACkGrpB;;;;;;;;AAQA,+C,ipEAPA,6B,CACA;AACA,kC,CACA;AACA,kBACA;AAKA;AACA;AACA;AACA;;AAKA;AACA;AACA;AACA;AACA;AACA,KAHA;AAIA,GANA;AAOA;;AAKA;AACA;AACA;AACA;AACA;AACA,KAHA;AAIA,GANA;AAOA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAJA;AAKA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KALA;AAMA;AACA;AACA,C;;AAEA;AACA,MADA,kBACA;AACA;AACA,eADA;AAEA,eAFA;AAGA,wBAHA;AAIA;AACA,0BADA;AAEA,gCAFA,EAJA;;AAQA,wBARA,EAQA;AACA,mBATA;AAUA,eAVA;AAWA,gBAXA;AAYA,yBAZA;AAaA,kCAbA;;AAeA,GAjBA;AAkBA;AACA,eADA,yBACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OALA;AAMA;AACA,KAjBA,EAlBA;;AAqCA;AACA,eADA,uBACA,GADA,EACA;AACA;AACA;AACA;AACA,KALA,EArCA;;AA4CA;AACA;AACA,oBADA,GADA;;AAIA,eAJA,uBAIA,QAJA,EAIA;AACA;AACA;AACA;AACA;AACA;AACA,OAJA;AAKA;AACA,KAZA;AAaA,eAbA,uBAaA,IAbA,EAaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAXA,CAWA;AACA,KAzBA;AA0BA,WA1BA,mBA0BA,IA1BA,EA0BA,SA1BA,EA0BA;AACA;AACA;AACA;AACA;AACA;AACA,OALA;AAMA;AACA,KAlCA;AAmCA,aAnCA,qBAmCA,GAnCA,EAmCA;AACA;AACA,KArCA;AAsCA,YAtCA,sBAsCA;AACA;AACA,oBADA;;AAGA,KA1CA;AA2CA,cA3CA,sBA2CA,GA3CA,EA2CA,KA3CA,EA2CA;AACA;AACA,gBADA;AAEA;AACA;AACA;AACA,WAHA,EAFA;;;AAQA,KApDA;AAqDA,iBArDA,yBAqDA,IArDA,EAqDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBADA;AAEA,wBAFA;AAGA;AACA;AACA;AACA;AACA;AACA,8BADA;;AAGA,SAVA;;AAYA,KAxEA;AAyEA,0BAzEA,kCAyEA,CAzEA,EAyEA;AACA;AACA,KA3EA;AA4EA,kBA5EA,0BA4EA,cA5EA,EA4EA;AACA;AACA;AACA,qBADA;AAEA,+BAFA;AAGA,2BAHA;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OARA;AASA;AACA,mBADA;AAEA,iCAFA;AAGA;AACA;AACA;AACA;AACA;AACA,sBADA;;AAGA;AACA;AACA;AACA;AACA,yBADA;AAEA,gCAFA;AAGA,+BAHA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA,eAVA;;AAYA,WAdA,EAcA,KAdA,CAcA;AACA;AACA,yBADA;AAEA,kCAFA;AAGA,+BAHA;;AAKA,WApBA,EAoBA,OApBA,CAoBA;AACA;AACA,WAtBA;AAuBA,SAlCA;;AAoCA,KAnIA,GA5CA,E;;;;;;;;;;;;;ACjKA;AAAA;AAAA;AAAA;AAAi6B,CAAgB,i3BAAG,EAAC,C;;;;;;;;;;;ACAr7B;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/system/menu/list.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/system/menu/list.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./list.vue?vue&type=template&id=5890e632&\"\nvar renderjs\nimport script from \"./list.vue?vue&type=script&lang=js&\"\nexport * from \"./list.vue?vue&type=script&lang=js&\"\nimport style0 from \"./list.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/system/menu/list.vue\"\nexport default component.exports","export * from \"-!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./list.vue?vue&type=template&id=5890e632&\"","var components\ntry {\n  components = {\n    uniBadge: function() {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-badge/components/uni-badge/uni-badge\" */ \"@/uni_modules/uni-badge/components/uni-badge/uni-badge.vue\"\n      )\n    },\n    unicloudDb: function() {\n      return import(\n        /* webpackChunkName: \"node-modules/@dcloudio/uni-cli-shared/components/unicloud-db\" */ \"@dcloudio/uni-cli-shared/components/unicloud-db.vue\"\n      )\n    },\n    uniTable: function() {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-table/components/uni-table/uni-table\" */ \"@/uni_modules/uni-table/components/uni-table/uni-table.vue\"\n      )\n    },\n    uniTr: function() {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-table/components/uni-tr/uni-tr\" */ \"@/uni_modules/uni-table/components/uni-tr/uni-tr.vue\"\n      )\n    },\n    uniTh: function() {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-table/components/uni-th/uni-th\" */ \"@/uni_modules/uni-table/components/uni-th/uni-th.vue\"\n      )\n    },\n    uniTd: function() {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-table/components/uni-td/uni-td\" */ \"@/uni_modules/uni-table/components/uni-td/uni-td.vue\"\n      )\n    },\n    fixWindow: function() {\n      return import(\n        /* webpackChunkName: \"components/fix-window/fix-window\" */ \"@/components/fix-window/fix-window.vue\"\n      )\n    }\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./list.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./list.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t<view class=\"uni-tabs__header\">\r\n\t\t\t<view class=\"uni-tabs__nav-wrap\">\r\n\t\t\t\t<view class=\"uni-tabs__nav-scroll\">\r\n\t\t\t\t\t<view class=\"uni-tabs__nav\">\r\n\t\t\t\t\t\t<view @click=\"switchTab('menus')\" :class=\"{'is-active':currentTab==='menus'}\"\r\n\t\t\t\t\t\t\tclass=\"uni-tabs__item\">\r\n\t\t\t\t\t\t\t菜单管理\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view @click=\"switchTab('pluginMenus')\" v-if=\"pluginMenus.length\"\r\n\t\t\t\t\t\t\t:class=\"{'is-active':currentTab==='pluginMenus'}\" class=\"uni-tabs__item\">\r\n\t\t\t\t\t\t\t待添加菜单\r\n\t\t\t\t\t\t\t<uni-badge class=\"menu-badge\" :text=\"pluginMenus.length\" type=\"error\"></uni-badge>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view v-show=\"currentTab==='menus'\">\r\n\t\t\t<view class=\"uni-header\" style=\"border-bottom: 0;margin-bottom: -15px;\">\r\n\t\t\t\t<view class=\"uni-group\">\r\n\t\t\t\t\t<button @click=\"navigateTo('./add')\" size=\"mini\" plain=\"true\" type=\"primary\">新增一级菜单</button>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"uni-group\">\r\n\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"uni-container\">\r\n\t\t\t\t<unicloud-db ref=\"udb\" @load=\"onqueryload\" collection=\"opendb-admin-menus\" :options=\"options\"\r\n\t\t\t\t\t:where=\"where\" page-data=\"replace\" :orderby=\"orderby\" :getcount=\"true\" :page-size=\"options.pageSize\"\r\n\t\t\t\t\t:page-current=\"options.pageCurrent\" v-slot:default=\"{data,pagination,loading,error}\">\r\n\t\t\t\t\t<uni-table :loading=\"loading\" :emptyText=\"errMsg || '没有更多数据'\" border stripe>\r\n\t\t\t\t\t\t<uni-tr>\r\n\t\t\t\t\t\t\t<uni-th align=\"center\">排序</uni-th>\r\n\t\t\t\t\t\t\t<uni-th width=\"200\" align=\"center\">名称</uni-th>\r\n\t\t\t\t\t\t\t<uni-th align=\"center\">标识</uni-th>\r\n\t\t\t\t\t\t\t<uni-th align=\"center\">URL</uni-th>\r\n\t\t\t\t\t\t\t<uni-th width=\"100\" align=\"center\">是否启用</uni-th>\r\n\t\t\t\t\t\t\t<uni-th width=\"160\" align=\"center\">操作</uni-th>\r\n\t\t\t\t\t\t</uni-tr>\r\n\t\t\t\t\t\t<uni-tr v-for=\"(item,index) in data\" :key=\"index\">\r\n\t\t\t\t\t\t\t<uni-td align=\"center\">{{item.sort}}</uni-td>\r\n\t\t\t\t\t\t\t<uni-td>{{item.name}}</uni-td>\r\n\t\t\t\t\t\t\t<uni-td>{{item.menu_id}}</uni-td>\r\n\t\t\t\t\t\t\t<uni-td>{{item.url}}</uni-td>\r\n\t\t\t\t\t\t\t<uni-td align=\"center\" :class=\"{'menu-disable':!item.enable}\">{{item.enable?'已启用':'未启用'}}\r\n\t\t\t\t\t\t\t</uni-td>\r\n\t\t\t\t\t\t\t<uni-td align=\"center\">\r\n\t\t\t\t\t\t\t\t<view class=\"uni-group\">\r\n\t\t\t\t\t\t\t\t\t<button v-if=\"!item.url\" @click=\"navigateTo('./add?parent_id='+item.menu_id, false)\"\r\n\t\t\t\t\t\t\t\t\t\tclass=\"uni-button\" size=\"mini\" type=\"primary\">子菜单</button>\r\n\t\t\t\t\t\t\t\t\t<button @click=\"navigateTo('./edit?id='+item._id, false)\" class=\"uni-button\"\r\n\t\t\t\t\t\t\t\t\t\tsize=\"mini\" type=\"primary\">修&nbsp;&nbsp;&nbsp;改</button>\r\n\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\tv-if=\"item.menu_id !== 'system_menu' && item.menu_id !== 'system_management'\"\r\n\t\t\t\t\t\t\t\t\t\t@click=\"confirmDelete(item)\" class=\"uni-button\" size=\"mini\"\r\n\t\t\t\t\t\t\t\t\t\ttype=\"warn\">删&nbsp;&nbsp;&nbsp;除</button>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</uni-td>\r\n\t\t\t\t\t\t</uni-tr>\r\n\t\t\t\t\t</uni-table>\r\n\t\t\t\t</unicloud-db>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view v-show=\"currentTab==='pluginMenus'\">\r\n\t\t\t<view class=\"uni-header\" style=\"border-bottom: 0;margin-bottom: -15px;\">\r\n\t\t\t\t<view class=\"uni-group\">\r\n\t\t\t\t\t<button style=\"width: 130px;\" @click=\"addPluginMenus\" size=\"mini\" type=\"primary\">添加选中的菜单</button>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"uni-group\"></view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"uni-container\">\r\n\t\t\t\t<uni-table ref=\"pluginMenusTable\" type=\"selection\" border stripe\r\n\t\t\t\t\t@selection-change=\"pluginMenuSelectChange\">\r\n\t\t\t\t\t<uni-tr>\r\n\t\t\t\t\t\t<uni-th align=\"center\">名称（标识）</uni-th>\r\n\t\t\t\t\t\t<uni-th align=\"center\">URL</uni-th>\r\n\t\t\t\t\t\t<uni-th align=\"center\">插件菜单 json 文件</uni-th>\r\n\t\t\t\t\t</uni-tr>\r\n\t\t\t\t\t<uni-tr v-for=\"(item,index) in pluginMenus\" :key=\"index\">\r\n\t\t\t\t\t\t<uni-td>{{item.name}}（{{item.menu_id}}）</uni-td>\r\n\t\t\t\t\t\t<uni-td>{{item.url}}</uni-td>\r\n\t\t\t\t\t\t<uni-td>{{item.json}}</uni-td>\r\n\t\t\t\t\t</uni-tr>\r\n\t\t\t\t</uni-table>\r\n\t\t\t\t<view class=\"uni-sub-title\" style=\"margin-top: 15px;\">\r\n\t\t\t\t\t以上待添加菜单来自于三方插件，添加后，将显示在菜单管理中，若不希望显示在上述表格中时，可手动删除项目中对应的`插件id-menu.json`文件。\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<!-- #ifndef H5 -->\r\n\t\t<fix-window />\r\n\t\t<!-- #endif -->\r\n\t</view>\r\n</template>\r\n\r\n<script>\n\timport { buildMenus } from '../../../components/uni-data-menu/util.js'\r\n\tconst db = uniCloud.database()\r\n\t// 表查询配置\r\n\tconst dbOrderBy = 'create_date asc'\r\n\t// 分页配置\r\n\tconst pageSize = 20\r\n\tconst pageCurrent = 1\r\n\r\n\timport {\r\n\t\tmapActions\r\n\t} from 'vuex'\r\n\t// 查找插件注册的菜单列表（目前仅在开发模式启用，仅限 admin 角色）\r\n\tconst pluginMenuJsons = []\r\n\tif (process.env.NODE_ENV === 'development') {\r\n\t\tconst rootModules = require.context(\r\n\t\t\t'../../../',\r\n\t\t\tfalse,\r\n\t\t\t/-menu.json$/\r\n\t\t)\r\n\t\trootModules.keys().forEach(function(key) {\r\n\t\t\tconst json = key.substr(2)\r\n\t\t\trootModules(key).forEach(item => {\r\n\t\t\t\titem.json = json\r\n\t\t\t\tpluginMenuJsons.push(item)\r\n\t\t\t})\r\n\t\t})\r\n\t\tconst pluginModules = require.context(\r\n\t\t\t'../../../uni_modules/',\r\n\t\t\ttrue,\r\n\t\t\t/menu.json$/\r\n\t\t)\r\n\t\tpluginModules.keys().forEach(function(key) {\r\n\t\t\tconst json = 'uni_modules' + key.substr(1)\r\n\t\t\tpluginModules(key).forEach(item => {\r\n\t\t\t\titem.json = json\r\n\t\t\t\tpluginMenuJsons.push(item)\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\t// 获取父的个数\r\n\tfunction getParents(menus, id, depth = 0) {\r\n\t\tmenus.forEach(menu => {\r\n\t\t\tif (menu.menu_id === id && menu.parent_id) {\r\n\t\t\t\tdepth = depth + 1 + getParents(menus, menu.parent_id, depth)\r\n\t\t\t}\r\n\t\t})\r\n\t\treturn depth\r\n\t}\r\n\r\n\t// 获取子的 _id\r\n\tfunction getChildren(menus, id, childrenIds = []) {\r\n\t\tif (menus.find(menu => menu.parent_id === id)) {\r\n\t\t\tmenus.forEach(item => {\r\n\t\t\t\tif (item.parent_id === id) {\r\n\t\t\t\t\tchildrenIds.push(item._id)\r\n\t\t\t\t\tgetChildren(menus, item.menu_id, childrenIds)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t\treturn childrenIds\r\n\t}\r\n\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tquery: '',\r\n\t\t\t\twhere: '',\r\n\t\t\t\torderby: dbOrderBy,\r\n\t\t\t\toptions: {\r\n\t\t\t\t\tpageSize,\r\n\t\t\t\t\tpageCurrent\r\n\t\t\t\t},\r\n\t\t\t\tselectedIndexs: [], //批量选中的项\r\n\t\t\t\tloading: true,\r\n\t\t\t\tmenus: [],\r\n\t\t\t\terrMsg: '',\r\n\t\t\t\tcurrentTab: 'menus',\r\n\t\t\t\tselectedPluginMenuIndexs: []\r\n\t\t\t}\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\tpluginMenus() {\r\n\t\t\t\tconst menus = []\r\n\t\t\t\tif (!this.$hasRole('admin')) {\r\n\t\t\t\t\treturn menus\r\n\t\t\t\t}\r\n\t\t\t\tconst dbMenus = this.menus\r\n\t\t\t\tif (!dbMenus.length) {\r\n\t\t\t\t\treturn menus\r\n\t\t\t\t}\r\n\t\t\t\tpluginMenuJsons.forEach(menu => {\r\n\t\t\t\t\t// 查找尚未被注册到数据库中的菜单\r\n\t\t\t\t\tif (!dbMenus.find(item => item.menu_id === menu.menu_id)) {\r\n\t\t\t\t\t\tmenus.push(menu)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\treturn menus\r\n\t\t\t},\r\n\t\t},\r\n\t\twatch: {\r\n\t\t\tpluginMenus(val) {\r\n\t\t\t\tif (!val.length) {\r\n\t\t\t\t\tthis.currentTab = 'menus'\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t...mapActions({\r\n\t\t\t\tinit: 'app/init'\r\n\t\t\t}),\n\t\t\tgetSortMenu(menuList) {\n\t\t\t\t// 标记叶子节点\n\t\t\t\tmenuList.map(item => {\n\t\t\t\t\tif (!menuList.some(subMenuItem => subMenuItem.parent_id === item.menu_id)) {\n\t\t\t\t\t\titem.isLeafNode = true\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\treturn buildMenus(menuList)\n\t\t\t},\r\n\t\t\tonqueryload(data) {\r\n\t\t\t\tfor (var i = 0; i < data.length; i++) {\r\n\t\t\t\t\tlet item = data[i]\r\n\t\t\t\t\tconst depth = getParents(data, item.menu_id)\r\n\t\t\t\t\titem.name = (depth ? '　'.repeat(depth) + '|-' : '') + item.name\r\n\t\t\t\t}\n\t\t\t\tconst menuTree = this.getSortMenu(data)\n\t\t\t\tconst sortMenus = []\n\t\t\t\tthis.patTree(menuTree, sortMenus)\n\t\t\t\tdata.length = 0;\n\t\t\t\tdata.push(...sortMenus)\n\t\t\t\tthis.menus = data //仅导出当前页\r\n\t\t\t},\n\t\t\tpatTree(tree, sortMenus) {\n\t\t\t\ttree.forEach(item => {\n\t\t\t\t\tsortMenus.push(item)\n\t\t\t\t\tif (item.children.length) {\n\t\t\t\t\t\tthis.patTree(item.children, sortMenus)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\treturn sortMenus\n\t\t\t},\r\n\t\t\tswitchTab(tab) {\r\n\t\t\t\tthis.currentTab = tab\r\n\t\t\t},\r\n\t\t\tloadData(clear = true) {\r\n\t\t\t\tthis.$refs.udb.loadData({\r\n\t\t\t\t\tclear\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tnavigateTo(url, clear) { // clear 表示刷新列表时是否清除当前页码，true 表示刷新并回到列表第 1 页，默认为 true\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl,\r\n\t\t\t\t\tevents: {\r\n\t\t\t\t\t\trefreshData: () => {\r\n\t\t\t\t\t\t\tthis.loadData(clear)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tconfirmDelete(menu) {\r\n\t\t\t\tlet ids = menu._id\r\n\t\t\t\tlet content = '是否删除该菜单？'\r\n\t\t\t\t// 如有子菜单\r\n\t\t\t\tconst children = getChildren(this.menus, menu.menu_id)\r\n\t\t\t\tif (children.length) content = '是否删除该菜单及其子菜单？'\r\n\t\t\t\tids = [ids, ...children]\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\tcontent,\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tif (!res.confirm) {\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.$refs.udb.remove(ids, {\r\n\t\t\t\t\t\t\tneedConfirm: false\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tpluginMenuSelectChange(e) {\r\n\t\t\t\tthis.selectedPluginMenuIndexs = e.detail.index\r\n\t\t\t},\r\n\t\t\taddPluginMenus(confirmContent) {\r\n\t\t\t\tif (!this.selectedPluginMenuIndexs.length) {\r\n\t\t\t\t\treturn uni.showModal({\r\n\t\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\t\tcontent: '请选择要添加的菜单！',\r\n\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\tconst pluginMenus = this.pluginMenus\r\n\t\t\t\tconst menus = []\r\n\t\t\t\tthis.selectedPluginMenuIndexs.forEach(i => {\r\n\t\t\t\t\tconst menu = pluginMenus[i]\r\n\t\t\t\t\tif (menu) {\r\n\t\t\t\t\t\t// 拷贝一份，移除 json 字段\r\n\t\t\t\t\t\tconst dbMenu = JSON.parse(JSON.stringify(menu))\r\n\t\t\t\t\t\tdelete dbMenu.json\r\n\t\t\t\t\t\tmenus.push(dbMenu)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\tcontent: '您确认要添加已选中的菜单吗？',\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tif (!res.confirm) {\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\t\tmask: true\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tconst checkAll = menus.length === pluginMenus.length\r\n\t\t\t\t\t\tuniCloud.database().collection('opendb-admin-menus').add(menus).then(res => {\r\n\t\t\t\t\t\t\tthis.init()\r\n\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\t\t\t\tcontent: '添加菜单成功！',\r\n\t\t\t\t\t\t\t\tshowCancel: false,\r\n\t\t\t\t\t\t\t\tsuccess: () => {\r\n\t\t\t\t\t\t\t\t\tthis.$refs.pluginMenusTable.clearSelection()\r\n\t\t\t\t\t\t\t\t\tif (checkAll) {\r\n\t\t\t\t\t\t\t\t\t\tthis.currentTab = 'menus'\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tthis.loadData()\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}).catch(err => {\r\n\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\t\t\t\tcontent: err.message,\r\n\t\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}).finally(() => {\r\n\t\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n<style>\r\n\t/* #ifndef H5 */\r\n\tpage {\r\n\t\tpadding-top: 85px;\r\n\t}\r\n\r\n\t/* #endif */\r\n\t.menu-disable {\r\n\t\tcolor: red;\r\n\t}\r\n\r\n\t.menu-badge {\r\n\t\tposition: absolute;\r\n\t\ttop: 0;\r\n\t\tright: 5px;\r\n\t}\r\n</style>\n","import mod from \"-!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./list.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\工具安装包\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./list.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1625726706206\n      var cssReload = require(\"D:/工具安装包/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}